# Тема 50 - ChainMap

`[ChainMap]` - подкласс dict. Представляет собой структуру данных, которая объединяет несколько словарей в один логический объект. Он позволяет создавать цепочки словарей и обеспечивает эффективный способ работы с данными нескольких словарей одновременно. 

- Изменение содержания любого словаря, на основании которого создан ChainMap, изменяет и сам ChainMap объект.
- Изменение ChainMap объекта приводит к изменению словаря, на основании которого он создан.
- ChainMap не создает новый словарь, он просто объединяет несколько словарей в один и предоставляет способ обращаться к ним как к единому целому.
- Изменения происходят только с первым в очереди словарём
- Поиск ключей осуществляется по всем словарям в списке.
- Встроенная функция len() возвращает количество `уникальных` ключей ChainMap объекта.
- При попытке обратиться к несуществующему ключу произойдёт ошибка

#

### Способы создания:  

1. `Использование конструктора с несколькими словарями`: Это самый прямой способ создать ChainMap, передав в конструктор несколько словарей как аргументы. 
```
(chain_map = ChainMap(dict1, dict2))
```
2. `Использование метода new_child()`: Метод new_child() создает новый объект ChainMap, на основе уже старого, добавляя новый словарь в начало цепочки. Это полезно, если ты хочешь добавить новый словарь без изменения старого. Метод new_chaild() не обновляет имеющийся словарь, а возвращает новый.
<details>
   <summary>Пример</summary>

```
from collections import ChainMap

# Создаем исходный ChainMap
original_chainmap = ChainMap({'a': 1, 'b': 2})

# Создаем новый словарь
new_dict = {'c': 3, 'd': 4}

# Создаем новый ChainMap с новым словарем в начале цепочки
new_chainmap = original_chainmap.new_child(new_dict)

# Выводим новый ChainMap
print(new_chainmap)   # ChainMap({'c': 3, 'd': 4}, {'a': 1, 'b': 2})
```
</details>

#

### Изменение данных в ChainMap объекте
1. `Прямое присваивание`: Можно использовать прямое присваивание для изменения значения существующего ключа или добавления новой пары ключ-значение в первом словаре цепочки. 

`chain_map['key'] = new_value`

2. `Метод update()`: Этот метод позволяет обновлять значения ключей, используя словарь или итерируемый объект пар ключ-значение. При этом добавление происходит в первый словарь, оставляя наибольшие значения.
<details>
   <summary>Пример</summary>

```
from collections import ChainMap

# Создаем ChainMap с двумя словарями
chainmap = ChainMap({'a': 1, 'b': 2}, {'c': 3, 'd': 4})

# Создаем новый словарь для обновления
new_values = {'b': 20, 'd': 40, 'e': 5}

# Обновляем словари в цепочке с помощью метода update()
chainmap.update(new_values)

# Выводим обновленный ChainMap
print(chainmap)   # ChainMap({'a': 1, 'b': 20, 'd': 40, 'e': 5}, {'c': 3, 'd': 4})
```
</details>

3. `Метод new_child()`: Если тебе нужно добавить новый словарь в цепочку, не изменяя существующие данные, можно использовать метод new_child(). Этот метод создает новый ChainMap, добавляя новый словарь в начало цепочки. `Метод new_chaild() не обновляет имеющийся словарь, а возвращает новый.`
<details>
   <summary>Пример</summary>

```
from collections import ChainMap

# Создаем исходный ChainMap
original_chainmap = ChainMap({'a': 1, 'b': 2})

# Создаем новый словарь
new_dict = {'c': 3, 'd': 4}

# Создаем новый ChainMap с новым словарем в начале цепочки
new_chainmap = original_chainmap.new_child(new_dict)

# Выводим новый ChainMap
print(new_chainmap)   # ChainMap({'c': 3, 'd': 4}, {'a': 1, 'b': 2})
```
</details>

4. `Конструктор ChainMap`: При создании нового ChainMap можно добавить новый словарь в начало цепочки, передав его как аргумент конструктору. При повторении элементов, в результирующем словаре остаются только элементы с большим значением.
<details>
   <summary>Пример</summary>
  
```
from collections import ChainMap

# Пример использования
dict1 = {'a': 1, 'b': 2}
dict2 = {'c': 3, 'd': 4}

chainmap = chainmaps(dict1, dict2)
print(chainmap)
```
</details>

5. `Атрибут maps`: (chainmap.maps) представляет собой список всех словарей, которые составляют цепочку ChainMap. Этот список обеспечивает доступ к каждому словарю в цепочке, позволяя оперировать с ними отдельно или вместе, в зависимости от потребностей. Изменяя список maps изменяется и объект ChainMap и наоборот. Атрибут maps Является обычным списком, по этому поддерживает все методы списков.
<details>
   <summary>Пример</summary>

```
from collections import ChainMap

# Создаем ChainMap с двумя словарями
chainmap = ChainMap({'a': 1, 'b': 2}, {'c': 3, 'd': 4})

# Получаем доступ к списку словарей в цепочке с помощью атрибута maps
chainmap_list = chainmap.maps

# Создаём новый ChainMap объект из получившегося списка
new_chainmap = ChainMap(*chainmap_list)

# Выводим список словарей
print(chainmap_list)   # [{'a': 1, 'b': 2}, {'c': 3, 'd': 4}]
# Выводим новый ChainMap объект из получившегося списка
print(new_chainmap)   # ChainMap({'a': 1, 'b': 2}, {'c': 3, 'd': 4})

```
</details>

6. `Атрибут parents`: возвращает новый объект ChainMap, содержащий все словари, кроме первого.
<details>
   <summary>Пример</summary>

```
from collections import ChainMap

# Создаем ChainMap с несколькими словарями
chainmap = ChainMap({'a': 1, 'b': 2}, {'c': 3, 'd': 4}, {'e': 5, 'f': 6})

# Создаем новый ChainMap, содержащий все словари, кроме первого
parents_chainmap = chainmap.parents

# Выводим новый ChainMap
print(parents_chainmap)   # ChainMap({'c': 3, 'd': 4}, {'e': 5, 'f': 6})
```
</details>

#

### Доступ к элементам ChainMap:

1. `Доступ по ключу`: Ты можешь использовать квадратные скобки [ ] и ключ для доступа к значению по ключу, так же как у обычного словаря.
2. `Метод get(value, default)`: Этот метод также позволяет получить значение по ключу, но если ключ отсутствует, он вернет значение по умолчанию (по умолчанию None, если не указано иное).
3. `Методы keys(), values(), items()`
4. `Проверка наличия ключа`: Ты также можешь использовать оператор in для проверки наличия ключа в ChainMap.

      - Поиск по ChainMap объекту всегда осуществляется в том же порядке, в котором словари были указаны при создании ChainMap объекта, при этом поиск останавливается, как только значение по нужному ключу найдено.
      - Когда у объединяемых словарей есть повторяющиеся ключи, мы получаем только значение из первого словаря, в котором встречается этот ключ.

#

### Итерирование по ChainMap объекту

1. Итерирование происходит по словарям в обратном порядке, от последнего добавленного словаря к первому. 
2. При итерировании по ChainMap объекту мы можем использовать методы keys(), values(), items().

#

### Дополнительно о ChainMap

1. Встроенная функция `len()` возвращает количество уникальных ключей ChainMap объекта.
2. Атрибут `.maps` создаёт список словарей, составляющих цепочку объекта ChainMap. В полученом списке можно изменять все словари.

      - Что бы из полученного списка словарей получить обратно объект ChainMap достаточно распаковать наш список в функции Chaimap(*our_list)
