# Тема 41 - ZIP-файлы

`[zip]` - это формат архивных файлов, который используется для сжатия данных без потерь: после распаковки данные будут такими же, как перед сжатием. 

<details>
  <summary>Архивация данных</summary>

1. `[Архивация данных]` - это упаковка нескольких файлов в один файл или поток — архив.  
   
3. `[Архивный файл]` - это специальным образом организованный файл, содержащий в себе один или несколько файлов в сжатом или несжатом виде и служебную информацию об именах файлов, дате и времени их создания или модификации, размерах и т.д.  
   
4. `[Степень сжатия файла]` - это мера того, насколько сильно файл был сжат при процессе архивации или сжатия данных. Это обычно выражается в процентах или в коэффициенте сжатия.  

Чем выше степень сжатия, тем больше данных удалено или сокращено в файле, и, следовательно, меньше размер файла. Например, если файл изначально был 100 МБ и после сжатия его размер составляет 20 МБ, это означает, что файл сжался до 20% от своего исходного размера, и его степень сжатия составляет 80%.

5. `[Архивация (упаковка)]` -  помещение (загрузка) исходных файлов в архивный файл в сжатом или несжатом виде.  

6. `[Разархивация (распаковка)]` - то процесс извлечения файлов из архивного файла обратно в их исходное состояние после архивации.

7. `[Архиваторы]` -  это программы или инструменты, которые предназначены для создания, открытия, просмотра, изменения, извлечения и управления архивными файлами (WinRAR, 7-Zip, WinZip, PeaZip, и другие).

#

### Отличие сжатия от архивации:

`[Сжатие файла]:`

- Сжатие файла - это процесс уменьшения размера файла путем удаления избыточных или повторяющихся данных без объединения с другими файлами.  
- Цель сжатия файла - уменьшить его размер, чтобы сэкономить место на диске или ускорить передачу файла через сеть.  
- Сжатие обычно применяется к одному файлу, и результатом процесса является сжатый файл.


`[Архивайия файла]:`

- Архивация файла - это процесс объединения одного или нескольких файлов в один архивный файл с последующим сжатием данных.  
- Цель архивации - уменьшить размер группы файлов и/или организовать их в один файл для удобства хранения и передачи.  
- Архивация может включать в себя сжатие файлов, но также может включать другие операции, такие как шифрование данных или добавление метаданных к файлам.  
- Результатом процесса архивации является архивный файл, который содержит один или несколько файлов в сжатом виде.

Таким образом, основное различие между сжатием файла и архивацией файла заключается в том, что сжатие применяется к одному файлу для уменьшения его размера, в то время как архивация объединяет несколько файлов в один архивный файл для упрощения управления данными.


</details>
<details>
  <summary>Модуль zipfile</summary>

`[zipfile]` - модуль предоставляет инструменты для работы с ZIP-архивами. Основное преимущество данного модуля заключается в том, что он позволяет работать с архивом, как с обычной папкой, содержащей файлы и другие каталоги.

- `[ZipFile(filename, mode='r', compression=ZIP_STORED, allowZip64=True)]` - это основной объект, предоставляемый модулем zipfile, который позволяет работать с zip архивами в Python.

     - `[filename]` - параметр определяющий файл, с которым будет работать ZipFile объект.
     - `[mode=]` - режим доступа к файлу (чтение 'r', запись 'w', добавление 'a')
     - `[compression=]` - пределяет метод сжатия для новых файлов, по умолчанию используется без сжатия (ZIP_STORED)
     - `[allowZip64=]` - указывает, разрешено ли использование формата ZIP64 для архивов, которые превышают размер 4 ГБ, о умолчанию True.

Объекты ZipFile похожи на файловые объекты, возвращаемые функцией open()

```
from zipfile import ZipFile

with ZipFile('test.zip') as zip_file:
    pass
```
#
### Основные методы Модуля zipfile  

1. `[printdir()]` - выводит таблицу с информацией о содержимом архива: полные названия файлов (File Name) с указанием даты изменения (Modified) и размера в байтах (Size).
```
from zipfile import ZipFile

with ZipFile('test.zip') as zip_file:
    zip_file.printdir()
```

#

2. `[infolist()]` - позволяет получить информацию о файлах из архива в виде списка специальных объектов (тип ZipInfo. Объект ZipInfo является итерируемым), которые содержат дополнительную информацию о каждом файле:

      - `[file_size]` - размер начального файла в байтах
      - `[compress_size]` - размер сжатого файла в байтах
      - `[filename]` - имя файла
      - `[date_time]` - дата изменения файла, представляет из себя кортеж (год, месяц, день, час, минута, секунда).
      - `[is_dir()]` - проверяет тип объекта: файл или папка. Он возвращает True, если объект является папкой, или False в противном случае.
```
from zipfile import ZipFile

with ZipFile('test.zip') as zip_file:
    info = zip_file.infolist()
    print(info[6].file_size)                # размер начального файла в байтах
    print(info[6].compress_size)            # размер сжатого файла в байтах
    print(info[6].filename)                 # имя файла
    print(info[6].date_time)                # дата изменения файла
    print(info[6].is_dir())
```

#

3. `[namelist()]` - возвращает список названий файлов и директорий, содержащихся в архиве. Метод получает список имен файлов в архиве, и затем итерируется по этому списку, выводя каждое имя файла или директории. Объект namelist итерируется.
```
from zipfile import ZipFile

with ZipFile('test.zip') as zip_file:
    info = zip_file.namelist()
    print(*info, sep='\n')
```

#

4. `[getinfo()]` - позволяет получить информацию о конкретном файле по его имени в архиве. Возвращает итерируемый объект ZipInfo. Так же обладает атриибутами `[file_size]`, `[compress_size]`, `[filename]`, `[date_time]` и `[is_dir()]`.
```
from zipfile import ZipFile

with ZipFile('test.zip') as zip_file:
    info = zip_file.namelist()                # получаем названия всех файлов архива
    last_file = zip_file.getinfo(info[-4])    # получаем информацию об отдельном файле
    print(last_file.file_size)
    print(last_file.compress_size)
    print(last_file.filename)
    print(last_file.date_time)
```

При вызове метода getinfo('file1.txt') мы получаем объект zipfile.ZipInfo, который содержит всю доступную информацию о файле 'file1.txt' в архиве example.zip. Затем мы можем использовать атрибуты этого объекта, такие как filename, file_size, compress_size, date_time и другие, чтобы получить конкретную информацию о файле.

</details>
<details>
  <summary>Работа с конкретными файлами из zip архива</summary>

### Чтение данных из конкретного файла
- Для чтения конкретного файла из ZIP-архива в Python можно использовать вложенный блок with.
```
from zipfile import ZipFile

with ZipFile('test.zip') as zip_file:
    with zip_file.open('test/Разные файлы/astros.json') as file:
        print(file.read().decode('utf-8'))
```
1. Внешний блок with открывает ZIP-архив и создает объект ZipFile, который представляет собой интерфейс для работы с архивом.
2. Вложенный блок with открывает конкретный файл из архива, указывая его полный путь внутри архива.
3. Файл открывается в бинарном режиме (для чтения байтов), поэтому для удобства чтения его содержимого в текстовом виде часто используется метод decode() с указанием соответствующей кодировки.
4. Далее можно работать с содержимым файла в соответствии с его типом, будь то текстовый файл, JSON, изображение или что-то еще.
5. Узнать путь к файлу можно при помощи отдельного блока `[with]` и использования метода `[printdir()]`:
```
from zipfile import ZipFile

with ZipFile('test.zip') as zip_file:
    zip_file.printdir()
```

</details>
<details>
  <summary>Запись в zip архив</summary>
- Для записи данных в zip архив требуется соблюсти несколько условий:

   - Первое - нужно знать, что архив будет создан в директории с программой. При необходимости нужно перейти в другую директорию принудительно.
   - Второе - Файлы, которые необходимо заархивировать, должны находиться в той же директории,в которой планируется создание или изменение архива. Если файл не будет найдет, возникнет исключение `[FileNotFoundError]`
   - Для записи файлов необходимо создать объект ZipFile в режимах mode='w' или mode='a'.
   - Для добавления файлов в уже существующий архив необходимо создать объект ZipFile в режиме mode='a'
#
- `[write(name, new_name)]` - Метод для записи файла в архив. В качестве аргумента принимает имя файла, который нужно записать в архив. У метода есть второй необязательный аргкмент, меняющий название исходного, записываемого файла на произвольное.
```
from zipfile import ZipFile

with ZipFile('archive.zip', mode='a') as zip_file:
    zip_file.write('program.py')
    zip_file.write('lse.jpeg')
    print(zip_file.namelist())   # ['program.py', 'lse.jpeg']
    zip_file.write('program.py', 'new_program.py')
    print(zip_file.namelist())    # ['new_program.py', 'lse1.jpeg']
```
cоздает в папке с программой архив с именем archive.zip и записывает в него содержимое файлов program.py и lse.jpeg, которые так же находятся в папке с программой, а затем выводит список всех файлов данного архива.

</details>











  
