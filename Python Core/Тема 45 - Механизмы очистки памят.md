# Тема 45 - Механизмы очистки памят

Стандартный интерпретатор Python использует сразу два механизма очистки памяти:

   - Подсчет ссылок
   - Сборщик мусора (Garbage Collector, GC)
#

### Подсчёт ссылок

Подсчёт ссылок - автоматический процесс интерпритатора Python.

1. Каждый объект наследуется от базового класса PyObject. В каждом PyObject есть поле подсчёта ссылок на этот объект (Reference Count).

- Каждый рах когда на объект начинает ссылаться другой объект, поле Reference Count уведичивается на 1.

- Как только поле подсчёта ссылок обнуляется, интерпретатов Python удаляет объект.

- Когда удаляется объект, у всех объектов, на которые он ссылался, поле Reference Count становится -1.

2. 4 сценария увеличения количества ссылок у объекта:

      - Создание объекта и присвоение ему имени.
      - Ссылка новой переменной на уже существующий объект (оператор =).
      - Передача объекта в качестве аргумента функции.
      - Добавление переменной в коллекцию.
  
3. 4 сценария удаления ссылки у объекта:

      - Удаление объекта из области видимости функции
      - Удаление переменной оператором del
      - Присвоение переменной нового дначения
      - Удаление переменной из коллекции
  
4. `[getrefcount()]` - функция из модуля sys, для получения количества ссылок на объект. В качестве аргумента принимает объект. Возвращает целое число - кол-во ссылок на переданный объект.

5. Подсчёт ссылок не работает с циклическими ссылками, когда объекты ссылаются сами на себя или два объекта ссылаются друг на друга.

#

### Сборщик мусора

1. `[Сборщик мусора]` - алгоритмя очистки памяти.

- Считает ссылки на объект. Удаляет объекты, на которые нет ссылок.

- Отслеживает циклические ссылки. Удаляет объект не имеющий ссылок, кроме циклических.

- Работает в динамике. Во врем работы программы, отслеживает переменные, которые подлежат удалению.

- Построе на принципе трёх поколений (0, 1, 2).

Новые переменные бодверженны тчательной и частой проверке сборщиком мусора.  
Чем больше циклов сборки мусора пережила переменная, тем на большее поколение она переходит, тем реже подвергается проверке сборщиком мусора.  
Если происходит сборка мусора в старшем поколении переменных, то она происходит и в млаждших поколениях.

2. Модуль gs

- `[import gs]` - модуль, предназначеный для управления сборщиком мусора.

- `[gs.enable()]` - включает сборщик мусора.
- `[gs.disable()]` - выключает сборщик мусора.
- `[gs.isenable()]` - True - сборщик мусора включен, False - выключен (по умолчанию включен).
- `[gs.collect(generation)]` - Запускает сбор мусора на всех трёх поколениях, либо при указании параметра generation (0, 1, 2) запускает сборку на конкретном поколении.

3. GIL

- `[GIL]` - (Global interpretor lock) в многопоточных программах, автоматическая система блокировки потоков для их поочерёдного выполнения.

Позволяет избежать одновременного сбора мусора в разных потоках.

4. При отображении объектов, содержащих циклические ссылки, используется нотация [. . .]:

```
num = [1, 2, 3]
num.append(num)

print(num)   # [1, 2, 3, [...]]
```










