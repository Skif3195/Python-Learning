# Тема 39 - CSV-файлы `[]`

- `[CSV]` - (Comma-Separated Values - значения, разделённые запятыми) — текстовый формат, представления табличных данных.Строка текста соответствует строке таблицы, которая содержит одно или несколько полей, а значения разделены запятыми (или другим разделителем, таким как точка с запятой или табуляция).

     - `[TSV]` - (Tab-Separated Values - значения, разделённые табуляцией) - текстовый формат, как и `[CSV]`, только разделитель - символ табуляции `[\t]`
     - `[DSV]` - (Delimited Separated Values - значения, разделённые разделителями) - обобщенный формат, где значения разделяются произвольным разделителем, который может быть запятой, табуляцией, точкой с запятой или другим символом.
#
<details>
  <summary>Пример</summary>
 
- Например, таблица:
```
Rank     Language     Share   
 1        Python      31.17%  
 2         Java       17.75%  
 3       JavaScrip      8%
 4          C#         7.05%  
 5         PHP         6.09%  
```
- в формате csv будет выглядеть так:
```
Rank,Language,Share
1,Python,31.17%
2,Java,17.75%
3,JavaScript,8%
4,C#,7.05%
5,PHP,6.09%
```
#
</details>

#


### Метод splitlines()

- `[splitlines()]` - Строковый метод (аналог split('\n')), построчно разделяет текст используя в качестве разделителя символ преноса строки `[\n]`.
```
# Чтение содержимого CSV файла
with open('file.csv', 'r') as file:
    csv_content = file.read()

# Разделение содержимого на строки
csv_lines = csv_content.splitlines()

# Теперь csv_lines содержит список строк из файла CSV
for line in csv_lines:
    # Обработка каждой строки
    print(line)
```
#
- Если в одном поле более одного слова - значения этого поля стоит заключать в кавычки:
```
keywords,price,product_name

"Садовый стул, стул для дачи",1699,ВЭДДО
"Складной стол, обеденный стол",7499,ЭПЛАРО
"Кружка, сосуд, стакан с ручкой",39,СТЕЛЬНА

Молочник,299,ВАРДАГЕН
Термос для еды,699,ЭФТЕРФРОГАД
Ситечко,59,ИДЕАЛИСК
```

#

# Модуль CSV

- `[CSV]` - модуль стандартной библиотеки Python. Предоставляет функционал для работы с файлами CSV, упрощая чтение, запись и обработку данных в этом формате. 

<details>
  <summary>Возможности модуля csv</summary>

1. Чтение данных из CSV файла: Модуль csv предоставляет методы для чтения данных из CSV файла, включая csv.reader() и csv.DictReader(). Первый метод возвращает список строк из файла, а второй - словарь для каждой строки, где ключами являются заголовки столбцов.

2. Запись данных в CSV файл: Модуль также позволяет записывать данные в CSV файлы с помощью метода csv.writer(), который позволяет записывать как список, так и словарь данных в файл.

3. Настройка разделителей и других параметров: Модуль позволяет настраивать различные параметры формата CSV, такие как символ разделителя, символ окончания строки и другие.

4. Обработка исключений: Модуль предоставляет обработку исключений для удобной работы с ошибками при чтении или записи файлов.
</details>

#

# Чтение данных

<details>
  <summary>csv.reader</summary>
     
- `[csv.reader]` - объект, последовательно считывает строки из csv-файла, создавая объект итератор, в котором каждый элемент (каждая строка файла) - список.

     - Работает с файлом, открытым только в режиме `[r]`.
     - Создаёт итератор.
     - Каждую строку форматирует в список.
#
- `[csv.reader(file)]` - просто считывает файл построчно и создаёт из каждой строки список. При этом не делит строки на элементы на основе разделителя, поскольку не знает, какой разделитель использовать. Поэтому каждая строка будет представлена в виде одного элемента списка.
```
import csv

# Пример строки в файле CSV
# "Садовый стул, стул для дачи";1699;ВЭДДО

with open('file.csv', 'r') as file:
    csv_reader = csv.reader(file)
    for row in csv_reader:
        print(row)

# Получится список строк, в котором наша строка примет вид:
# ['Садовый стул, стул для дачи;1699;ВЭДДО']
```
#
Если нам нужно каждую строку файла привести к списку стандартного вида, т.е. используются определенные разделители и символы кавычек, мы можем использовать параметры delimiter и quotechar, чтобы указать модулю csv, как правильно разбить строки на элементы списка.
- `[csv_file = csv.reader(file, delimiter=';', quotechar='"')]`

     - delimiter - Указывает какой разделитель используется в файле.
     - quotechar - указывает какой симфол используется в файле вместо кавычек (в случае, если в ячейке больше одного слова).
```
import csv

# Пример строки в файле CSV
# "Садовый стул, стул для дачи";1699;ВЭДДО

with open('file.csv', 'r') as file:
    csv_file = csv.reader(file, delimiter=';', quotechar='"')
    for row in csv_reader:
        print(row)

# Получится список строк, в котором наша строка примет вид:
# ['Садовый стул, стул для дачи', '1699', 'ВЭДДО']
```
#
</details>

#


<details>
  <summary>csv.DictReader</summary>

- `[csv.DictReader]` - объект, читайет csv-файл и представляет каждую строку в виде словаря, где где ключами будут названия столбцов, а значениями - соответствующие значения этой строки.

     - Важно использовать DictReader с параметрами delimiter и quotechar, чтобы указать модулю csv, как правильно разделять строки файла.

Принцип работы:

1. Когда ты создаешь объект DictReader и передаешь ему открытый файл CSV, он считывает первую строку файла, которая обычно содержит названия столбцов (заголовки).

2. Затем, для каждой последующей строки файла, DictReader создает словарь, где ключами будут названия столбцов из заголовка, а значениями - соответствующие значения из этой строки.

3. В результате, при итерации по объекту DictReader ты получаешь словарь для каждой строки, что делает работу с данными удобнее, поскольку ты можешь обращаться к значениям по именам столбцов, а не индексам.

```
import csv

# Пример строки в файле CSV
# "Садовый стул, стул для дачи";1699;ВЭДДО
# Первая строка в файле : keywords;price;product_nam

with open('products.csv', 'r') as file:
    csv_file = csv.DictReader(file, delimiter=';', quotechar='"')
    for row in csv_file:
        print(row)

# Получится список словарей, в котором наша строка примет вид:
# {'keywords': 'Садовый стул, стул для дачи', 'price': '1699', 'product_name': 'ВЭДДО'}
```
При создании `[DictReader]` объекта значениями по умолчанию для аргументов `[delimiter]` и `[quotechar]` являются `[',']` (символ запятой) и `['"']` (символ двойной кавычки) соответственно.

#
</details>

#

# Запись данных

<details>
  <summary>csv.writer</summary>

- `[csv.writer]` - объект, который предоставляет методы для записи данных в CSV файл.

     - Работает с файлом,открытым только в режимаф `[w]`,`[r+]` и `[a]`
     - Записывает в файл только списки.
     - `[csv.writer(file)]` - без параметров, записывает в файл данные в стандартном виде (разделитель - запятая `[,]`, кавычки - двойные кавычки`["]`) 
```
import csv

# Добавляем список используя writer без параметров

with open('products.csv', 'w') as file:
    csv_writer = csv.writer(file)
    csv_writer.writerow(['Алексей', 30, 'Программист, увлекается музыкой'])

# В файл запишется строка: Алексей,30,"Программист, увлекается музыкой"
```
  - `[csv.writer(file, delimiter,quoting ,quotechar)]` - параметры позволяют изменить символ-разделитель и символ-кавычки.
  - Параметр `[quoting]` - указывает на то, какие значения заключать в кавычки.
<details>
  <summary>Параметры quoting</summary>
     
```
- quoting=csv.QUOTE_ALL: указывает объектам записи указывать все поля
- quoting=csv.QUOTE_MINIMAL: указывает объектам записи заключать в кавычки только те поля, которые содержат специальные символы, такие как разделитель delimiter, кавычка quotechar или любой из символов в lineterminator
- quoting=csv.QUOTE_NONNUMERIC: указывает объектам записи указывать все нечисловые поля
- quoting=csv.QUOTE_NONE: указывает объектам записи никогда не заключать в кавычки поля
```
#
</details>

```
import csv

with open('products.csv', 'w') as file:
    csv_writer = csv.writer(file, delimiter='|',quoting=csv.QUOTE_NONNUMERIC ,quotechar='*')
    csv_writer.writerow(['Алексей', 30, 'Программист, увлекается музыкой'])

# В файл запишется строка: *Алексей*|30|*Программист, увлекается музыкой*
```

#
</details>

#

<details>
  <summary>csv.DictWriter</summary>



#
</details>




